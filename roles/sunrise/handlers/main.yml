- name: update facts so we can see if the timezone is correct now
  setup:
  listen: "print datetime"

- name: print datetime after setting timezone
  debug:
    var: ansible_date_time
  listen: "print datetime"

# - name: just force systemd to reread configs (2.4 and above)
#   systemd:
#     daemon_reload: yes
#   listen: "reload caddy"
- name: reload caddy
  service:
    name: caddy
    state: reloaded
  # listen: "reload caddy"

- name: restart caddy
  service:
    name: caddy
    state: restarted
  listen: restart caddy

- name: let caddy bind to ports 80 and 443
  capabilities:
    path: /usr/local/bin/caddy
    capability: cap_net_bind_service=+ep
    state: present
  listen: restart caddy

- name: make www-data owner #of everything in the darn directory
  file:
    path: /srv/{{ item.domain_name }}/{{ item.subdomain }}
    owner: www-data
    group: www-data
    recurse: yes
  loop: "{{ handcoded_websites }}"

- name: regenerate hugo
  command: hugo
  args:
    chdir: /srv/{{ domain_name }}
    creates: /srv/{{ domain_name }}/public