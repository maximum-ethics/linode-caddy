- name: restart cron
  service:
    name: cron
    state: restarted
  listen: restart cron + print time
  when: ansible_os_family == 'Debian'
- name: update facts so we can see if the timezone is correct now
  setup:
  listen: restart cron + print time
- name: print datetime after setting timezone
  debug:
    var: ansible_date_time
  listen: restart cron + print time

- name: reload caddy
  service:
    name: caddy
    state: reloaded

- name: restart caddy
  service:
    name: caddy
    state: restarted
  listen: restart caddy

- name: let caddy bind to ports 80 and 443
  capabilities:
    path: /usr/local/bin/caddy
    capability: cap_net_bind_service=+ep
    state: present
  listen: restart caddy

- name: make www-data owner #of everything in the darn directory
  file:
    path: /srv/{{ item.domain_name }}/{{ item.subdomain }}
    owner: www-data
    group: www-data
    recurse: yes
  loop: "{{ handcoded_websites }}"

- name: regenerate hugo
  command: hugo
  args:
    chdir: /srv/{{ domain_name }}
    creates: /srv/{{ domain_name }}/public